# Example docker-compose.yml with environment variables
# Copy this to docker-compose.yml and set your values

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: galleria
    ports:
      - "3000:3000"
      - "3001:3001"
    environment:
      - NODE_ENV=production
      - PORT=3001
      - HOST=0.0.0.0
      - DATA_DIR=/data
      # Set your frontend domain (with or without protocol)
      - FRONTEND_DOMAIN=${FRONTEND_DOMAIN:-https://www.example.com}
      # Set your backend domain (with or without protocol)
      - BACKEND_DOMAIN=${BACKEND_DOMAIN:-https://api.example.com}
      # Optional: Additional allowed origins (comma-separated)
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS:-}
      # Optional: Logging level (error, warn, info, debug, verbose)
      - LOG_LEVEL=${LOG_LEVEL:-info}
      
      # NVIDIA GPU support for hardware video encoding
      # Uncomment these lines if you have an NVIDIA GPU and want hardware acceleration
      # You must also uncomment the 'runtime: nvidia' line below
      # - NVIDIA_VISIBLE_DEVICES=all
      # - NVIDIA_DRIVER_CAPABILITIES=compute,video,utility
    volumes:
      # Mount your data directory (photos, database, config, etc.)
      - ${DATA_DIR:-/path/to/your/data}:/data
    restart: unless-stopped
    
    # Uncomment this line to enable NVIDIA GPU support for hardware video encoding
    # Requires: NVIDIA Docker runtime (nvidia-docker2) installed on host
    # Install: https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html
    # runtime: nvidia
    
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3001/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

