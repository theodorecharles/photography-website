# Example docker-compose.yml with environment variables
# Copy this to docker-compose.yml and set your values

version: '3.8'

services:
  backend:
    build:
      context: .
      dockerfile: backend/Dockerfile
    container_name: galleria-backend
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=production
      - PORT=3001
      - DATA_DIR=/data
      # Set your frontend domain (with or without protocol)
      - FRONTEND_DOMAIN=https://www.tedcharles.net
      # Set your backend domain (with or without protocol)
      - BACKEND_DOMAIN=https://api.tedcharles.net
      # Optional: Additional allowed origins (comma-separated)
      # - ALLOWED_ORIGINS=https://example.com,https://another.com
    volumes:
      # Mount your data directory (photos, database, config, etc.)
      - /path/to/your/data:/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3001/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  frontend:
    build:
      context: .
      dockerfile: frontend/Dockerfile
    container_name: galleria-frontend
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - PORT=3000
      - DATA_DIR=/data
      # Backend API URL (should match BACKEND_DOMAIN above)
      - API_URL=https://api.tedcharles.net
    volumes:
      # Mount data directory read-only (for config.json)
      - /path/to/your/data:/data:ro
    depends_on:
      backend:
        condition: service_healthy
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3000"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

