# Photo Permalink Meta Tag Enhancement

## Overview
This update adds dynamic Open Graph meta tag injection for photo permalinks, enabling rich previews when sharing individual photos on social media platforms like iMessage, Telegram, Facebook, and Twitter.

## What Changed
Modified `/frontend/server.js` to detect photo permalink URLs (e.g., `/album/nature?photo=image.jpg`) and dynamically inject:

1. **Photo-specific metadata:**
   - Page title includes the photo name
   - Photo thumbnail as the preview image
   - Custom description with photo and album info

2. **Open Graph tags for social sharing:**
   - `og:title` - Photo name and album
   - `og:description` - Custom description
   - `og:image` - Photo thumbnail URL
   - `og:url` - Full permalink
   - `og:type` - Changed to "article" for individual photos

3. **Twitter Card tags:**
   - Same enhancements as Open Graph

## How It Works

When a request comes in for a URL like:
```
https://www.tedcharles.net/album/nature?photo=00257-00040-Edit.jpg
```

The server:
1. Detects the `?photo=` parameter
2. Extracts the album name and photo filename
3. Reads the `index.html` file
4. Replaces all meta tags with photo-specific values
5. Returns the modified HTML

### Example Meta Tags Generated

**Before (generic):**
```html
<meta property="og:title" content="Ted Charles - Photography Portfolio" />
<meta property="og:image" content="http://localhost:3000/photos/avatar.png" />
```

**After (photo-specific):**
```html
<meta property="og:title" content="00257 00040 Edit - Nature" />
<meta property="og:image" content="https://api.tedcharles.net/optimized/thumbnail/nature/00257-00040-Edit.jpg" />
```

## Testing

### 1. Local Testing

Restart the frontend server:
```bash
cd frontend
npm start
```

Visit a photo permalink:
```
http://localhost:3000/album/nature?photo=00257-00040-Edit.jpg
```

Check the console logs - you should see:
```
[Meta Injection] Photo permalink detected:
  Album: nature
  Photo: 00257-00040-Edit.jpg
  Title: 00257 00040 Edit
  OG Image: http://localhost:3001/optimized/thumbnail/nature/00257-00040-Edit.jpg
  Page URL: http://localhost:3000/album/nature?photo=00257-00040-Edit.jpg
```

### 2. Verify Meta Tags

View page source (Ctrl+U / Cmd+Option+U) and search for `og:image`. You should see the thumbnail URL.

### 3. Test Social Media Previews

Use these tools to test how the link appears:

- **Facebook:** https://developers.facebook.com/tools/debug/
- **Twitter:** https://cards-dev.twitter.com/validator
- **LinkedIn:** https://www.linkedin.com/post-inspector/

Paste your photo permalink URL and click "Fetch new information" or "Scrape".

### 4. Production Deployment

After deploying to production:

1. Build the project:
```bash
npm run build
```

2. Restart the services:
```bash
pm2 restart all
# or
./restart.sh
```

3. Test a production URL:
```
https://www.tedcharles.net/album/nature?photo=00257-00040-Edit.jpg
```

## URL Logic

The server automatically derives the site URL from the API URL:

- **Development:** `http://localhost:3001` → `http://localhost:3000`
- **Production:** `https://api.tedcharles.net` → `https://www.tedcharles.net`

## Security Features

- HTML special characters in photo titles are escaped to prevent XSS
- URLs are properly encoded
- Only matches legitimate album/photo patterns

## Browser Cache Considerations

### For Testing
If you're testing and not seeing updated meta tags:

1. **Hard refresh:** Ctrl+Shift+R (Windows/Linux) or Cmd+Shift+R (Mac)
2. **Clear cache:** Browser DevTools > Network > Disable cache
3. **Social media cache:** Use the debugging tools above to force a refresh

### For Users
Social media platforms cache meta tags aggressively (24-48 hours). After deployment:

- Old links may show old previews until cache expires
- Newly shared links will immediately show the photo preview
- Use Facebook's debug tool to manually refresh if needed

## Troubleshooting

### Meta tags not appearing

1. Check server logs for the `[Meta Injection]` message
2. Verify the URL has both `/album/{name}` and `?photo={filename}`
3. Ensure the photo file exists in the optimized/thumbnail directory

### Wrong image showing

1. Verify the photo filename matches exactly (case-sensitive)
2. Check that the thumbnail was generated by the optimization script
3. Look at the `OG Image` URL in the console logs

### Social media not showing preview

1. Wait 5 minutes for the platform to fetch the URL
2. Use the platform's debugging tool to force a refresh
3. Verify the image URL is publicly accessible (not localhost)
4. Check image file size (should be under 8MB for most platforms)

## Notes

- This only affects the **initial HTML** sent to crawlers
- React still handles the client-side rendering after the page loads
- The feature works for both development and production environments
- No changes needed to the React app itself

